<!DOCTYPE html>
<!--

|
|             *         *
|                  .                .
|           .
|     *                      ,
|                   .
|
|                               *
|          |\___/|
|          )    -(             .              '
|         =\  -  /=
|           )===(       *
|          /   - \
|          |-    |
|         /   -   \     0.|.0
|  NASY___\__( (__/_____(\=/)__+1s____________
|  ______|____) )______|______|______|______|_
|  ___|______( (____|______|______|______|____
|  ______|____\_|______|______|______|______|_
|  ___|______|______|______|______|______|____
|  ______|______|______|______|______|______|_
|  ___|______|______|______|______|______|____


Author           : Nasy https://nasy.moe <Nasy>
Date             : Mar 4, 2018
Email            : echo bmFzeXh4QGdtYWlsLmNvbQo= | base64 -D
Filename         : index.html
Last modified by : Nasy
License          : MIT


There are more things in heaven and earth, Horatio, than are dreamt.
  From "Hamlet"
-->

<html>

    <head>
        <meta charset="utf-8">

        <title>Python 3.7 带来的 Bug</title>

        <meta name="HandheldFriendly" content="True">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="description" content="Nasy 的花园，栽花养鱼闲聊的地方～">
        <meta name="twitter:creator" content="@nasyxx">

        <meta property="og:type" content="website">
        <meta property="og:title" content="Nasy Land">
        <meta property="og:url" content="https://nasy.moe/">
        <meta property="og:site_name" content="Nasy Land">
        <meta property="og:description" content="Nasy 的花园，栽花养鱼闲聊的地方～">

        <link rel="stylesheet" href="../../styles/main.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-102577027-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-102577027-1');
        </script>
    </head>
    <body>
        <div class="container" , id="container">

            <header class="header" id="header">
                <section class="header-section">
                    <h1 class="header-section-title main-title no-before">
                        <a href="NasyLand"> <i class="fas fa-star h1_icon"></i> </a>
                        Nasy Land
                    </h1>
                </section>
                <section class="header-section">
                    <nav class="header-section-nav nav">
                        <ul>
                            <li class="header-section-section-nav-list nav-list">
                                <a href="https://nasy.me" title="Who is Nasy?">Nasy</a>
                            </li>
                            <li class="header-section-section-nav-list nav-list">
                                <a href="../../" title="Blog">Blog</a>
                            </li>
                            <li class="header-section-section-nav-list nav-list">
                                <a href="https://pools.nasy.moe" title="Pools">Pools</a>
                            </li>
                            <li class="header-section-section-nav-list nav-list">
                                <a href="../../about#About" title="About">About</a>
                            </li>
                        </ul>
                    </nav>
                </section>
                
            </header>

            <main class="main" id="main">
                <section id="blog" class="blog">
    <header class="blog-header">
        
    <h1 id="Python 3.7 带来的 Bug">
        <a href="#Python 3.7 带来的 Bug">
            <i class="fas fa-star h1_icon"></i>
        </a>
        Python 3.7 带来的 Bug
    </h1>
    <section class="toc-n" style="cursor: context-menu;">
        <h3>Table of Content</h3>
    </section>
    <section class="blog-content-table">

    </section>
    <div class="h1-fixed opacity">
        <p class="h1 h1-fixed" style="position: fixed; cursor: context-menu; z-index: 3;" onclick="show_hide_toc();">Python 3.7 带来的 Bug</p>
        <section class="blog-content-table h1-fixed hidden" style="position: fixed; z-index: 2; top: 50px; border-top: medium none; box-shadow: none;">

        </section>
    </div>


<section class="metas">
    
        <section class="metas-author">
            <i class="icon fas fa-pencil-alt" title="author"></i>
            <span>Nasy</span>
        </section>
    

    
        <section class="metas-time">
            <i class="icon far fa-calendar-alt" title="time"></i>
            <time datetime="August 15, 2018">August 15, 2018</time>
        </section>
    

    
        <section class="metas-summary">
            <i class="icon fas fa-quote-left" title="summary"></i>
            <span>关键词 async 导致 Tensorflow 不能用。jedi 也有奇怪的问题。</span>
        </section>
    

    
        <section class="metas-categories">
            <i class="icon fas fa-tags" title="categories"></i>
            <ul><a href="../../categories/Essay/">Essay</a>, <a href="../../categories/Flower/">Flower</a></ul>
        </section>
    

    
        <section class="metas-tags">
            <i class="icon fas fa-hashtag" title="tags"></i>
            <ul><a href="../../tags/essay/">essay</a>, <a href="../../tags/flower/">flower</a>, <a href="../../tags/hana/">hana</a>, <a href="../../tags/python/">python</a>, <a href="../../tags/%E8%8A%B1/">花</a>, <a href="../../tags/%E9%9A%8F%E7%AC%94/">随笔</a></ul>
        </section>
    
</section>

    </section>
    <section>
        <nav class="text-table-of-contents"><ul>
<li><a href="#python-3.7-不能再使用-async-作为关键词">Python 3.7 不能再使用 async 作为关键词</a></li>
<li><a href="#jedi-的补全">Jedi 的补全</a></li>
</ul></nav>
<p>我很喜欢尝鲜，无论是生活上的，还是电脑上正在使用的内容。当然了，伴随着新事物的新特性，必然会带来很多奇奇怪怪的 bug。</p>
<h2 id="python-3.7-不能再使用-async-作为关键词">Python 3.7 不能再使用 async 作为关键词</h2>
<p>先看两个例子吧：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1">Python <span class="dv">3</span>.<span class="fl">6.6</span> (default, Aug  <span class="dv">3</span> <span class="dv">2018</span>, <span class="dv">18</span>:<span class="dv">10</span>:<span class="dv">32</span>)</a>
<a class="sourceLine" id="cb1-2" title="2">[GCC <span class="dv">4</span>.<span class="fl">2.1</span> Compatible Apple LLVM <span class="dv">10</span>.<span class="fl">0.0</span> (clang<span class="dv">-1000</span>.<span class="fl">10.38</span>)] on darwin</a>
<a class="sourceLine" id="cb1-3" title="3">Type <span class="st">&quot;help&quot;</span>, <span class="st">&quot;copyright&quot;</span>, <span class="st">&quot;credits&quot;</span> <span class="kw">or</span> <span class="st">&quot;license&quot;</span> <span class="cf">for</span> more information.</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="op">&gt;&gt;&gt;</span> <span class="cf">async</span> <span class="op">=</span> <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="op">&gt;&gt;&gt;</span> <span class="cf">async</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">''</span></a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1">Python <span class="dv">3</span>.<span class="fl">7.0</span> (default, Aug <span class="dv">13</span> <span class="dv">2018</span>, <span class="dv">03</span>:<span class="dv">32</span>:<span class="dv">41</span>)</a>
<a class="sourceLine" id="cb2-2" title="2">[Clang <span class="dv">10</span>.<span class="fl">0.0</span> (clang<span class="dv">-1000</span>.<span class="fl">10.38</span>)] on darwin</a>
<a class="sourceLine" id="cb2-3" title="3">Type <span class="st">&quot;help&quot;</span>, <span class="st">&quot;copyright&quot;</span>, <span class="st">&quot;credits&quot;</span> <span class="kw">or</span> <span class="st">&quot;license&quot;</span> <span class="cf">for</span> more information.</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="op">&gt;&gt;&gt;</span> <span class="cf">async</span> <span class="op">=</span> <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb2-5" title="5">  File <span class="st">&quot;&lt;stdin&gt;&quot;</span>, line <span class="dv">1</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="cf">async</span> <span class="op">=</span> <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb2-7" title="7">          <span class="op">^</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="pp">SyntaxError</span>: invalid syntax</a></code></pre></div>
<p>我相信，绝大多数情况下，这条不会对你产生任何影响，只要你不把 async 作为关键词。</p>
<p>不过，这个就苦了用 Tensorflow 的家伙了呢。问题是这样的，Tensorflow 中使用了 async 作为关键词，而且，这其中的部分代码还是 C/C++ 生成的…于是，无论你是从源码编译新的 Tensorflow，还是直接使用某个 whl 安装，在最终使用的时候，都会失败。（我才不会说当时，这个问题坑了我好久，还以为是我哪里的 cython 写错了！</p>
<p>好在，已经慢慢解决了。具体看这些 <a href="https://github.com/tensorflow/tensorflow/pull/20766/files/7000c3e30f7c5daf15e34f9a23a6ad3c98239ce3#diff-a1983d51233d117d820e7f1f367b157b">commit</a>.</p>
<p>Sample:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1">tensorflow::Status CreateRemoteContexts(</a>
<a class="sourceLine" id="cb3-2" title="2">    const std::vector<span class="op">&lt;</span>string<span class="op">&gt;&amp;</span> remote_workers, int64 rendezvous_id,</a>
<a class="sourceLine" id="cb3-3" title="3">    const tensorflow::ServerDef<span class="op">&amp;</span> server_def,</a>
<a class="sourceLine" id="cb3-4" title="4">    tensorflow::eager::EagerClientCache<span class="op">*</span> remote_eager_workers, <span class="bu">bool</span> <span class="cf">async</span>,</a>
<a class="sourceLine" id="cb3-5" title="5">    tensorflow::eager::EagerClientCache<span class="op">*</span> remote_eager_workers, <span class="bu">bool</span> is_async,</a></code></pre></div>
<p>解决方案：用 <code>pyenv</code> 吧！</p>
<h2 id="jedi-的补全">Jedi 的补全</h2>
<p>这个问题是我在使用 Emacs 时遇到的。当时，无论是 Emacs 的 <code>lsp-mode</code> 还是 <code>anaconda-mode</code> 甚至是 <code>elpy</code> 都遇到了一个问题，补全的时候，只要我定义函数的时候，加上了 type hinting，就不会出现。在我尝试了很多之后，终于意识到这个是 jedi 的问题: <a href="https://github.com/davidhalter/jedi/issues/1198">issue/1198</a>.</p>
<p>（我当时认为是 Emacs 的问题，还在 emacs-china 提了个问 <a href="https://emacs-china.org/t/python-type-hint/6663">QUESTION</a>，真是感想热心群众的帮忙呢。</p>
<p>解决方案：用 <code>pyenv</code> 吧！</p>
<hr />
<p>嘛，其实，说了这么多，我想说的就是，遇到 python 的版本的问题，别犹豫，用 pyenv 吧！</p>
    </section>
</article>
<hr />
<div id="gitalk-comment">
</div>
<!-- gitalk -->
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    function init_comment() {
        const gitalk = new Gitalk({
            clientID: 'cb5605d5ea28ce5ba8d2',
            clientSecret: '942e0d9f31ea8d7d30845fa26bc51ed6551153d8',
            repo: 'comments',
            owner: 'nasyxx',
            admin: ['nasyxx'],
            id: "comment",
            labels: ['comment'],
            createIssueManually: true,
            enableHotKey: true,
            perPage: 10,
            // facebook-like distraction free mode
            distractionFreeMode: false,
            body: location.href
        })
        
        gitalk.options.id = "Python 感想 003"
        
        
        gitalk.render("gitalk-comment")
    }
    try{
        init_comment()
    }catch{
        console.log("Not a Blog.")
    }
</script>

            </main>

            <footer id="footer">
                <section class="footer-section">
                    <nav class="header-section-nav nav">
                        <ul>
                            <li class="footer-section-nav-list nav-list">
                                <a href="https://nasy.me" title="Who is Nasy?">Nasy</a>
                            </li>
                            <li class="footer-section-nav-list nav-list">
                                <a href="../../" title="Blog">Blog</a>
                            </li>
                            <li class="footer-section-nav-list nav-list"><a href="https://pools.nasy.moe" title="Pools">Pools</a>
                            </li>
                            <li class="footer-section-nav-list nav-list">
                                <a href="../../about#About" title="About">About</a>
                            </li>
                        </ul>
                    </nav>
                    <nav id="friend-links" class="friend-links-nav">
                        <ul>
                            <li class="footer-section-nav-list nav-list">
                              <a href="https://laobubu.net" title="laobubu">Laobubu</a>
                            </li>
                            <li class="footer-section-nav-list nav-list">
                              <a href="https://yuki.yuki233.com" title="初雪">初雪</a>
                            </li>
                            <li class="footer-section-nav-list nav-list">
                              <a href="https://mitsuhachan.ml" title="三葉的喵窝">三葉的喵窝</a>
                            </li>
                            <li class="footer-section-nav-list nav-list">
                              <a href="https://blog.zsakvo.cc" title="水水的小窝">水水的小窝</a>
                            </li>
                            <li class="footer-section-nav-list nav-list">
                              <a href="https://daisuke.moe" title="白兔">白兔</a>
                            </li>
                        </ul>
                    </nav>
                </section>
                <section class="footer-section copyright">
                    <p>Copyright © 2018 Nasy</p>
                </section>
                <div style="text-align: right;">
                    <p style="position: fixed; bottom: 0px; right: 10vw;" onclick="up2top();">
                        <i class="fas fa-rocket fa-lg" title="up to top" data-fa-transform="rotate--45"></i>
                    </p>
                </div>
            </footer>
        </div>
        <!-- highlight -->
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

        <!-- momentjs -->
        <script defer src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.0/moment.min.js"></script>

        <!-- fontawesome -->
        <script async defer src="../../scripts/fa-brands.min.js"></script>
        <script async defer src="../../scripts/fa-solid.min.js"></script>
        <script async defer src="../../scripts/fa-regular.min.js"></script>
        <script async defer src="../../scripts/fontawesome.min.js"></script>

        <script src="../../scripts/main.js" charset="utf-8"></script>

        <!-- MathJax -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML" async type="text/javascript">
        </script>
    </body>
</html>
